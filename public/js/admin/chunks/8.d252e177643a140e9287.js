webpackJsonp([8],{188:function(e,a,t){Vue.component("multiselect",t(143).default),e.exports={props:["smsType"],data:function(){return{new_order:{user_id:null,package_id:null,usd_rate:null,status:null,sms_type:null},packages:[],selected_package:null,packageLoading:!1,table:null,order:{order_id:null,status:null,title:null,text:null,sms_type:null},loading:!1}},methods:{getUrlParam:function(){var e=window.location.pathname.split("/");this.new_order.user_id=e[4]},showNewOrder:function(){this.selected_package=null,this.new_order.status="confirm",this.$validator.reset(),$("#new_order").modal("show")},getPackages:function(e){var a=this;return this.packageLoading=!0,axios.post("/admin/order/packages",{name:e}).then(function(e){var t=e.data;a.packages=t,a.packageLoading=!1})},validateData:function(){var e=this;this.$validator.validateAll().then(function(a){a&&("Package"==e.smsType&&(e.new_order.package_id=e.selected_package.id),e.new_order.sms_type=e.smsType,e.saveOrder())}).catch(function(e){console.log(e)})},saveOrder:function(){var e=this;this.loading=!0,axios.post("/admin/order/create",this.new_order).then(function(a){var t=a.data;if(1==t.status)$("#new_order").modal("hide"),Notification.success("Success"),e.table.ajax.reload();else{var r="";for(var o in t.message)t.message.hasOwnProperty(o)&&(r+=t.message[o]+"<br/>");Notification.error(r)}e.loading=!1}).catch(function(a){401==a.response.status||419==a.response.status?window.location.href="/admin/login":Notification.error("Error occured while creating data."),e.loading=!1})},loadTable:function(){var e=this.new_order.user_id,a=0,t=[];t[a++]={data:"id",name:"id"},t[a++]={data:"invoice_no",name:"invoice_no"},"Package"==this.smsType?(t[a++]={data:"package.packageName",name:"package.packageName"},t[a++]={data:"cost",name:"cost"},t[a++]={data:"credit",name:"credit"},t[a++]={data:"extra_credit",name:"extra_credit"},t[a++]={data:"total_credit",name:"total_credit"}):"PAYG"==this.smsType&&(t[a++]={data:"cost",name:"cost"},t[a++]={data:"total_credit",name:"total_credit"}),t[a++]={data:"payment_date",name:"payment_date"},"Package"==this.smsType?t[a++]={data:"order_date",name:"order_date"}:"PAYG"==this.smsType&&(t[a++]={data:"invoice_date",name:"invoice_date"}),t[a++]={data:"status",name:"status"},t[a++]={data:"action",name:"action"},this.table=$("#order_list").DataTable({processing:!0,serverSide:!0,ajax:{url:"/admin/order/list/",data:function(a){a.user_id=e}},order:[[0,"desc"]],columns:t})},showConfirmModal:function(e){this.order.order_id=e,this.order.title="Confirm Order",this.order.text="Do you want to confirm this order?",this.order.status="confirm",$("#order_modal").modal("show")},showPaymentModal:function(e){this.order.order_id=e,this.order.title="Receive Payment",this.order.text="Do you want to complete this payment?",this.order.status="paid",$("#order_modal").modal("show")},showCancelModal:function(e){this.order.order_id=e,this.order.title="Cancel Order",this.order.text="Are you sure you want to cancel this order?",this.order.status="cancel",$("#order_modal").modal("show")},submit:function(){var e=this;this.loading=!0,this.order.sms_type=this.smsType,axios.post("/admin/order/update",this.order).then(function(a){var t=a.data;if(1==t.status)$("#order_modal").modal("hide"),Notification.success("Success"),e.table.ajax.reload();else{var r="";for(var o in t.message)t.message.hasOwnProperty(o)&&(r+=t.message[o]+"<br/>");Notification.error(r)}e.loading=!1}).catch(function(a){401==a.response.status||419==a.response.status?window.location.href="/admin/login":Notification.error("Error occured while deleting data."),e.loading=!1})}},mounted:function(){var e=this;this.getUrlParam(),this.loadTable(),$("#order_list").delegate(".confirm_order","click",function(a){var t=a.currentTarget.getAttribute("data-id");e.showConfirmModal(t)}),$("#order_list").delegate(".change_payment","click",function(a){var t=a.currentTarget.getAttribute("data-id");e.showPaymentModal(t)}),$("#order_list").delegate(".cancel_order","click",function(a){var t=a.currentTarget.getAttribute("data-id");e.showCancelModal(t)})}}}});