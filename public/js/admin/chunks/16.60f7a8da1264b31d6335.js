webpackJsonp([16],{184:function(e,a,t){Vue.component("multiselect",t(143).default),e.exports={components:{datePicker:function(e){return new Promise(function(e){e()}).then(function(){var a=[t(144)];e.apply(null,a)}.bind(this)).catch(t.oe)}},data:function(){return{table:null,packages:[],orderDate:null,packageId:null,status:"",order:{order_id:null,status:null,title:null,text:null},loading:!1,new_order:{user_id:null,package_id:null,status:"confirm",sms_type:null},selected_user:null,selected_package:null,asyncUsers:[],asyncPackages:[],userLoading:!1,packageLoading:!1,options:{format:"DD MMM YYYY",useCurrent:!1}}},methods:{selectablePackages:function(){var e=this;axios.get("/admin/package/packages").then(function(a){var t=a.data;e.packages=t})},getUrlParameter:function(){var e=window.location.pathname.split("/");this.packageId=e[4]?e[4]:""},loadTable:function(){var e=this;this.table=$("#order_list").DataTable({processing:!0,serverSide:!0,ajax:{url:"/admin/order/list/",data:function(a){a.order_date=e.orderDate,a.package_id=e.packageId,a.status=e.status}},order:[[0,"desc"]],columns:[{data:"id",name:"id"},{data:"invoice_no",name:"invoice_no"},{data:"user.username",name:"user.username"},{data:"package.packageName",name:"package.packageName"},{data:"cost",name:"cost"},{data:"credit",name:"credit"},{data:"extra_credit",name:"extra_credit"},{data:"total_credit",name:"total_credit"},{data:"payment_date",name:"payment_date"},{data:"order_date",name:"order_date"},{data:"status",name:"status"},{data:"action",name:"action",orderable:!1,searchable:!1}]})},showConfirmModal:function(e){this.order.order_id=e,this.order.title="Confirm Order",this.order.text="Do you want to confirm this order?",this.order.status="confirm",$("#order_modal").modal("show")},showPaymentModal:function(e){this.order.order_id=e,this.order.title="Receive Payment",this.order.text="Do you want to complete this payment?",this.order.status="paid",$("#order_modal").modal("show")},showCancelModal:function(e){this.order.order_id=e,this.order.title="Cancel Order",this.order.text="Are you sure you want to cancel this order?",this.order.status="cancel",$("#order_modal").modal("show")},submit:function(){var e=this;this.loading=!0,axios.post("/admin/order/update",this.order).then(function(a){var t=a.data;if(1==t.status)$("#order_modal").modal("hide"),Notification.success("Success"),e.table.ajax.reload();else{var r="";for(var o in t.message)t.message.hasOwnProperty(o)&&(r+=t.message[o]+"<br/>");Notification.error(r)}e.loading=!1}).catch(function(a){401==a.response.status||419==a.response.status?window.location.href="/admin/login":Notification.error("Error occured while deleting data."),e.loading=!1})},changeStatus:function(){this.table.draw()},changeDate:function(){this.table.draw()},showNewOrder:function(){this.selected_user=null,this.selected_package=null,this.new_order.status="confirm",this.$validator.reset(),$("#new_order").modal("show")},getUsers:function(e){var a=this;return this.userLoading=!0,axios.post("/admin/order/users",{name:e}).then(function(e){var t=e.data;a.asyncUsers=t,a.userLoading=!1})},getPackages:function(e){var a=this;return this.packageLoading=!0,axios.post("/admin/order/packages",{name:e}).then(function(e){var t=e.data;a.asyncPackages=t,a.packageLoading=!1})},validateData:function(){var e=this;this.$validator.validateAll().then(function(a){a&&(e.new_order.user_id=e.selected_user.id,e.new_order.sms_type=e.selected_user.sms_type,e.new_order.package_id=e.selected_package.id,e.saveOrder())}).catch(function(e){console.log(e)})},saveOrder:function(){var e=this;this.loading=!0,axios.post("/admin/order/create",this.new_order).then(function(a){var t=a.data;if(1==t.status)$("#new_order").modal("hide"),Notification.success("Success"),e.table.ajax.reload();else{var r="";for(var o in t.message)t.message.hasOwnProperty(o)&&(r+=t.message[o]+"<br/>");Notification.error(r)}e.loading=!1}).catch(function(a){401==a.response.status||419==a.response.status?window.location.href="/admin/login":Notification.error("Error occured while creating data."),e.loading=!1})}},mounted:function(){var e=this;this.selectablePackages(),this.getUrlParameter(),this.loadTable(),$("#order_list").delegate(".confirm_order","click",function(a){var t=a.currentTarget.getAttribute("data-id");e.showConfirmModal(t)}),$("#order_list").delegate(".change_payment","click",function(a){var t=a.currentTarget.getAttribute("data-id");e.showPaymentModal(t)}),$("#order_list").delegate(".cancel_order","click",function(a){var t=a.currentTarget.getAttribute("data-id");e.showCancelModal(t)})}}}});